<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="Grafik.ChatPage"
             Title="Ð§Ð°Ñ‚">

    <Grid RowDefinitions="*,Auto" Padding="0">
        <!-- Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ -->
        <CollectionView x:Name="MessagesCollectionView"
                       SelectionMode="Single"
                       VerticalScrollBarVisibility="Always">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <StackLayout Padding="10,5" Spacing="5">
                        <!-- Ð˜Ð¼Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÐµÐ»Ñ + Ð²Ñ€ÐµÐ¼Ñ -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Label Grid.Column="0"
                                  Text="{Binding Sender}"
                                  FontAttributes="Bold"
                                  FontSize="13"
                                  TextColor="#007ACC"/>
                            <Label Grid.Column="1"
                                  Text="{Binding Timestamp, StringFormat='{0:HH:mm}'}"
                                  FontSize="11"
                                  TextColor="Gray"/>
                        </Grid>

                        <!-- Ð¢ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¸Ð»Ð¸ Ñ„Ð°Ð¹Ð» -->
                        <Label Text="{Binding Text}"
                              LineBreakMode="WordWrap"
                              FontSize="14"
                              Padding="0,0,0,5"/>

                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð´Ð»Ñ Ñ„Ð°Ð¹Ð»Ð¾Ð² -->
                        <Frame Padding="10" 
                               BackgroundColor="#E8F5E9" 
                               HasShadow="True" 
                               CornerRadius="8"
                               IsVisible="{Binding IsFile}"
                               Margin="0">
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                <StackLayout Grid.Column="0" Spacing="3">
                                    <Label Text="{Binding FileName, StringFormat='ðŸ“Ž {0}'}"
                                          FontAttributes="Bold"
                                          TextColor="#2E7D32"
                                          FontSize="12"/>
                                    <Label Text="{Binding FileSizeDisplay}"
                                          FontSize="10"
                                          TextColor="Gray"/>
                                </StackLayout>
                                
                                <Button Grid.Column="1"
                                       Text="â¬‡ï¸ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ"
                                       Clicked="OnDownloadFileClicked"
                                       CommandParameter="{Binding .}"
                                       BackgroundColor="#4CAF50"
                                       TextColor="White"
                                       Padding="10"
                                       FontSize="12"
                                       VerticalOptions="Center"/>
                            </Grid>
                        </Frame>

                        <!-- Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ -->
                        <BoxView Color="#CCCCCC" HeightRequest="1" Margin="0,5"/>
                    </StackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Ð’Ð²Ð¾Ð´ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
        <Grid Grid.Row="1"
             ColumnDefinitions="*,60,60"
             ColumnSpacing="8"
             Padding="10"
             RowSpacing="10"
             BackgroundColor="#F5F5F5">
            <Entry x:Name="MessageEntry"
                  Grid.Column="0"
                  Placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..."/>

            <Button Grid.Column="1"
                   Text="ðŸ“Ž"
                   Clicked="OnShareFileClicked"
                   BackgroundColor="#FF9800"
                   TextColor="White"
                   FontSize="18"
                   Padding="0"/>

            <Button Grid.Column="2"
                   Text="ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ"
                   Clicked="OnSendClicked"
                   BackgroundColor="#007ACC"
                   TextColor="White"/>
        </Grid>
    </Grid>

</ContentPage>